<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1.0" />
  <title>Movie Finder | Samma</title>
 <link rel="icon" type="image/svg+xml"
        href="data:image/svg+xml,
            <svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'>
                <text y='.9em' font-size='90'>ðŸŽ¬</text>
            </svg>">
</head>
<body>
  <div class="container">
    <header>
      <div class="ascii-art">
  ________     __       ___      ___  ___      ___       __      
 /"       )   /""\     |"  \    /"  ||"  \    /"  |     /""\     
(:   \___/   /    \     \   \  //   | \   \  //   |    /    \    
 \___  \    /' /\  \    /\\  \/.    | /\\  \/.    |   /' /\  \   
  __/  \\  //  __'  \  |: \.        ||: \.        |  //  __'  \  
 /" \   :)/   /  \\  \ |.  \    /:  ||.  \    /:  | /   /  \\  \ 
(_______/(___/    \___)|___|\__/|___||___|\__/|___|(___/    \___)
      </div>
      <h1>Movie Finder</h1>
      <p class="subtitle">Search for movie details using the Samma backend</p>
    </header>

    <div class="search-container">
      <input type="text" id="movieInput" placeholder="Enter a movie titleâ€¦" />
      <button onclick="fetchMovie()"><span>Search</span> <span>ðŸŽ¬</span></button>
    </div>

    <div class="recent-searches" id="recentSearches">
      <div class="recent-title">Recent Searches:</div>
      <div class="recent-list" id="recentList"></div>
    </div>

    <div class="loader" id="loader">
      <div class="spinner"></div>
      <p>Searching for movie detailsâ€¦</p>
    </div>

    <div class="error" id="error">Movie not found or backend error. Please try another title.</div>

    <div class="movie-result" id="movieResult">
      <div class="movie-poster">
        <img id="moviePoster" alt="Movie poster" />
      </div>
      <div class="movie-header">
        <h2 class="movie-title" id="movieTitleDisplay">Movie Title</h2>
        <span class="movie-year" id="movieYear">(Year)</span>
      </div>
      <div class="movie-info">
        <div class="detail-card">
          <h3 class="section-title">Plot Summary</h3>
          <p class="plot" id="moviePlot">Movie plot will appear hereâ€¦</p>
        </div>
        <div class="details-grid">
          <div class="detail-card">
            <h3 class="section-title">Cast</h3>
            <p class="cast" id="movieCast">Cast members will appear hereâ€¦</p>
          </div>
          <div class="detail-card">
            <h3 class="sectionâ€‘title">Details</h3>
            <p><strong>Director:</strong> <span id="movieDirector">N/A</span></p>
            <p><strong>Genre:</strong> <span id="movieGenre">N/A</span></p>
            <p><strong>Runtime:</strong> <span id="movieRuntime">N/A</span></p>
            <p><strong>IMDb Rating:</strong> <span id="movieRating">N/A</span></p>
          </div>
        </div>
      </div>
    </div>

    <div class="backend-status">
      <div class="status-dot" id="backend1"></div>
      <div class="status-dot" id="backend2"></div>
      <div class="status-dot" id="backend3"></div>
      <span class="status-text">Backend status</span>
    </div>
  </div>

  <footer>
    <p>Powered by Samma Backend API | Movie Finder Â© 2025</p>
  </footer>

  <script>
    // Failover logic intact
    const BACKENDS = [
      "https://samma-api.onrender.com",
      "https://samma-api-prod.onrender.com",
      "https://samma-api-failover.onrender.com"
    ];
    let currentBackendIndex = 0;
    let recentSearches = JSON.parse(localStorage.getItem("recentSearches")) || [];

    const elements = {
      loader: document.getElementById("loader"),
      error: document.getElementById("error"),
      movieResult: document.getElementById("movieResult"),
      movieInput: document.getElementById("movieInput"),
      recentSearches: document.getElementById("recentSearches"),
      recentList: document.getElementById("recentList"),
      statusDots: [
        document.getElementById("backend1"),
        document.getElementById("backend2"),
        document.getElementById("backend3")
      ]
    };

    const movieElements = {
      title: document.getElementById("movieTitleDisplay"),
      year: document.getElementById("movieYear"),
      plot: document.getElementById("moviePlot"),
      cast: document.getElementById("movieCast"),
      director: document.getElementById("movieDirector"),
      genre: document.getElementById("movieGenre"),
      runtime: document.getElementById("movieRuntime"),
      rating: document.getElementById("movieRating"),
      poster: document.getElementById("moviePoster")
    };

    function initRecentSearches() {
      if (recentSearches.length) {
        elements.recentSearches.classList.add("active");
        elements.recentList.innerHTML = "";
        recentSearches.slice(0, 5).forEach(title => {
          const item = document.createElement("div");
          item.className = "recent-item";
          item.textContent = title;
          item.onclick = () => {
            elements.movieInput.value = title;
            fetchMovie();
          };
          elements.recentList.appendChild(item);
        });
      }
    }

    function addToRecentSearches(title) {
      if (!recentSearches.includes(title)) {
        recentSearches.unshift(title);
        if (recentSearches.length > 5) recentSearches.pop();
        localStorage.setItem("recentSearches", JSON.stringify(recentSearches));
        initRecentSearches();
      }
    }

    function updateBackendStatus() {
      elements.statusDots.forEach((dot, idx) => {
        dot.classList.toggle("active", idx === currentBackendIndex);
      });
    }

    async function callBackend(path, retries = 2) {
      let lastError;
      for (let attempt = 0; attempt < retries; attempt++) {
        try {
          const response = await fetch(BACKENDS[currentBackendIndex] + path);
          if (!response.ok) throw new Error(`${response.status}: ${response.statusText}`);
          return await response.json();
        } catch (e) {
          console.error(`Attempt ${attempt + 1} failed at ${BACKENDS[currentBackendIndex]}${path}`, e);
          lastError = e;
          if (attempt === retries - 1 && currentBackendIndex < BACKENDS.length - 1) {
            currentBackendIndex++;
            updateBackendStatus();
            attempt = -1; // restart attempts with new backend
          }
        }
      }
      throw lastError;
    }

    function toggleElement(el, show) {
      el.classList.toggle("active", show);
    }

    async function fetchMovie() {
      const title = elements.movieInput.value.trim();
      if (!title) {
        elements.error.textContent = "Please enter a movie title";
        toggleElement(elements.error, true);
        return;
      }
      toggleElement(elements.error, false);
      toggleElement(elements.movieResult, false);
      toggleElement(elements.loader, true);
      addToRecentSearches(title);

      try {
        const data = await callBackend(`/movie?title=${encodeURIComponent(title)}`);
        // Poster logic (only if returned and not N/A)
        if (data.Poster && data.Poster !== "N/A") {
          movieElements.poster.src = data.Poster;
          movieElements.poster.alt = `Poster of ${data.Title}`;
          movieElements.poster.classList.add("active");
        } else {
          movieElements.poster.src = "";
          movieElements.poster.alt = "No poster available";
          movieElements.poster.classList.remove("active");
        }
        movieElements.title.textContent = data.Title || "Unknown Title";
        movieElements.year.textContent = `(${data.Year || "N/A"})`;
        movieElements.plot.textContent = data.Plot || "No plot summary available.";
        movieElements.cast.textContent = data.Actors || "Cast information not available.";
        movieElements.director.textContent = data.Director || "N/A";
        movieElements.genre.textContent = data.Genre || "N/A";
        movieElements.runtime.textContent = data.Runtime || "N/A";
        movieElements.rating.textContent = data.imdbRating || "N/A";

        toggleElement(elements.loader, false);
        toggleElement(elements.movieResult, true);
      } catch (e) {
        console.error("Fetch failed:", e);
        elements.error.textContent = "Movie not found or backend error. Please try another title.";
        toggleElement(elements.loader, false);
        toggleElement(elements.error, true);
      }
    }

    document.addEventListener("DOMContentLoaded", () => {
      updateBackendStatus();
      initRecentSearches();
      elements.movieInput.addEventListener("keydown", e => {
        if (e.key === "Enter") fetchMovie();
      });
      elements.movieInput.focus();
    });
  </script>
</body>
</html>
